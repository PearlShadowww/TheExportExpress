<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>360° Product View Test</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/framer-motion@12/dist/framer-motion.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for 360 view */
        .product-360-view {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .product-360-view img {
            transition: opacity 0.1s ease-in-out;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        .product-360-view [data-dragging="true"] {
            cursor: grabbing !important;
        }

        .product-360-view [data-dragging="false"] {
            cursor: grab;
        }

        .view-toggle-button {
            position: absolute;
            top: 1rem;
            left: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            padding: 0.5rem;
            border-radius: 0.5rem;
            background-color: rgba(255, 255, 255, 0.8);
            color: #374151;
            border: 1px solid rgba(229, 231, 235, 0.5);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            transition: all 0.2s ease-in-out;
            z-index: 10;
        }

        .view-toggle-button.active {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .view-toggle-button:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .view-toggle-button:active {
            transform: scale(0.95);
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;
        const { motion, AnimatePresence } = Motion;

        // Mock 360-degree images
        const mock360Images = Array.from({ length: 36 }, (_, i) => 
            `https://via.placeholder.com/600x400/${Math.floor(Math.random()*16777215).toString(16)}/FFFFFF?text=Frame+${i + 1}`
        );

        const mockRegularImages = [
            'https://via.placeholder.com/600x400/FF6B6B/FFFFFF?text=Main+Image+1',
            'https://via.placeholder.com/600x400/4ECDC4/FFFFFF?text=Main+Image+2',
            'https://via.placeholder.com/600x400/45B7D1/FFFFFF?text=Main+Image+3',
            'https://via.placeholder.com/600x400/96CEB4/FFFFFF?text=Main+Image+4'
        ];

        const Product360ViewDemo = () => {
            const [currentFrame, setCurrentFrame] = useState(0);
            const [isLoading, setIsLoading] = useState(true);
            const [loadedImages, setLoadedImages] = useState(new Set());
            const [isAutoRotating, setIsAutoRotating] = useState(false);
            const [isDragging, setIsDragging] = useState(false);
            const [is360ViewActive, setIs360ViewActive] = useState(false);
            const [selectedImageIndex, setSelectedImageIndex] = useState(0);

            const containerRef = useRef(null);
            const autoRotateRef = useRef(null);
            const totalFrames = 36;

            // Preload images
            useEffect(() => {
                const preloadImages = async () => {
                    setIsLoading(true);
                    const imagePromises = mock360Images.map((image, index) => {
                        return new Promise((resolve, reject) => {
                            const img = new Image();
                            img.onload = () => resolve(index);
                            img.onerror = () => reject(index);
                            img.src = image;
                        });
                    });

                    try {
                        const results = await Promise.allSettled(imagePromises);
                        const successfullyLoaded = new Set();
                        
                        results.forEach((result, index) => {
                            if (result.status === 'fulfilled') {
                                successfullyLoaded.add(index);
                            }
                        });
                        
                        setLoadedImages(successfullyLoaded);
                        setIsLoading(false);
                    } catch (error) {
                        console.error('Error preloading 360 images:', error);
                        setIsLoading(false);
                    }
                };

                preloadImages();
            }, []);

            // Auto-rotation
            const startAutoRotation = useCallback(() => {
                if (!isAutoRotating || isDragging) return;

                autoRotateRef.current = setInterval(() => {
                    setCurrentFrame((prev) => (prev + 1) % totalFrames);
                }, 100);
            }, [isAutoRotating, isDragging, totalFrames]);

            const stopAutoRotation = useCallback(() => {
                if (autoRotateRef.current) {
                    clearInterval(autoRotateRef.current);
                    autoRotateRef.current = null;
                }
            }, []);

            const toggleAutoRotation = useCallback(() => {
                setIsAutoRotating(!isAutoRotating);
            }, [isAutoRotating]);

            const toggle360View = useCallback(() => {
                setIs360ViewActive(!is360ViewActive);
            }, [is360ViewActive]);

            // Auto-rotation effect
            useEffect(() => {
                if (isAutoRotating && !isDragging && is360ViewActive) {
                    startAutoRotation();
                } else {
                    stopAutoRotation();
                }

                return () => stopAutoRotation();
            }, [isAutoRotating, isDragging, is360ViewActive, startAutoRotation, stopAutoRotation]);

            // Drag handling
            const handleDragStart = useCallback((event, info) => {
                setIsDragging(true);
                stopAutoRotation();
            }, [stopAutoRotation]);

            const handleDrag = useCallback((event, info) => {
                if (!isDragging) return;

                const deltaX = info.offset.x;
                const sensitivity = 5;
                const frameChange = Math.round(deltaX / sensitivity);
                const newFrame = (currentFrame + frameChange + totalFrames) % totalFrames;
                
                setCurrentFrame(newFrame);
            }, [isDragging, currentFrame, totalFrames]);

            const handleDragEnd = useCallback(() => {
                setIsDragging(false);
            }, []);

            // Navigation for regular images
            const goToNext = useCallback(() => {
                setSelectedImageIndex((prev) => 
                    prev === mockRegularImages.length - 1 ? 0 : prev + 1
                );
            }, []);

            const goToPrevious = useCallback(() => {
                setSelectedImageIndex((prev) => 
                    prev === 0 ? mockRegularImages.length - 1 : prev - 1
                );
            }, []);

            return (
                <div className="min-h-screen bg-gray-50 py-8">
                    <div className="max-w-4xl mx-auto px-4">
                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <h1 className="text-3xl font-bold text-gray-900 mb-2">
                                360° Product View Test
                            </h1>
                            <p className="text-gray-600 mb-8">
                                Interactive 360-degree product view with drag controls and touch gestures.
                            </p>

                            <div className="h-96 bg-gray-100 rounded-lg overflow-hidden relative">
                                {/* 360 View Toggle Button */}
                                <button
                                    onClick={toggle360View}
                                    className={`view-toggle-button ${is360ViewActive ? 'active' : ''}`}
                                    aria-label={is360ViewActive ? 'Switch to regular view' : 'Switch to 360° view'}
                                >
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                    </svg>
                                    <span className="text-xs font-medium">360°</span>
                                </button>

                                {is360ViewActive ? (
                                    /* 360-Degree View */
                                    <div className="product-360-view w-full h-full">
                                        <div 
                                            ref={containerRef}
                                            className="relative w-full h-full bg-gray-50 rounded-lg overflow-hidden focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            tabIndex={0}
                                        >
                                            {/* Loading State */}
                                            {isLoading && (
                                                <div className="absolute inset-0 flex items-center justify-center bg-gray-100">
                                                    <div className="text-center">
                                                        <motion.div
                                                            className="w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-2"
                                                            animate={{ rotate: 360 }}
                                                            transition={{ duration: 1, repeat: Infinity, ease: "linear" }}
                                                        />
                                                        <p className="text-gray-600 text-sm">Loading 360° view...</p>
                                                    </div>
                                                </div>
                                            )}

                                            {/* 360 Image Display */}
                                            {!isLoading && loadedImages.has(currentFrame) && (
                                                <motion.div
                                                    key={currentFrame}
                                                    className="w-full h-full"
                                                    initial={{ opacity: 0 }}
                                                    animate={{ opacity: 1 }}
                                                    transition={{ duration: 0.1 }}
                                                >
                                                    <motion.img
                                                        src={mock360Images[currentFrame]}
                                                        alt={`360° view frame ${currentFrame + 1}`}
                                                        className="w-full h-full object-contain select-none"
                                                        draggable={false}
                                                        drag="x"
                                                        onDragStart={handleDragStart}
                                                        onDrag={handleDrag}
                                                        onDragEnd={handleDragEnd}
                                                        dragConstraints={{ left: 0, right: 0 }}
                                                        dragElastic={0}
                                                        style={{ cursor: isDragging ? 'grabbing' : 'grab' }}
                                                    />
                                                </motion.div>
                                            )}

                                            {/* Controls */}
                                            <div className="absolute top-4 right-4 flex gap-2">
                                                <motion.button
                                                    onClick={toggleAutoRotation}
                                                    className={`p-2 rounded-full backdrop-blur-sm transition-colors ${
                                                        isAutoRotating 
                                                            ? 'bg-blue-500 text-white' 
                                                            : 'bg-white/80 text-gray-700 hover:bg-white'
                                                    }`}
                                                    whileHover={{ scale: 1.05 }}
                                                    whileTap={{ scale: 0.95 }}
                                                >
                                                    {isAutoRotating ? (
                                                        <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                                            <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
                                                        </svg>
                                                    ) : (
                                                        <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                                            <path d="M8 5v14l11-7z"/>
                                                        </svg>
                                                    )}
                                                </motion.button>

                                                <motion.button
                                                    onClick={() => setCurrentFrame(0)}
                                                    className="p-2 rounded-full bg-white/80 text-gray-700 hover:bg-white backdrop-blur-sm transition-colors"
                                                    whileHover={{ scale: 1.05 }}
                                                    whileTap={{ scale: 0.95 }}
                                                >
                                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                                    </svg>
                                                </motion.button>
                                            </div>

                                            {/* Progress Indicator */}
                                            <div className="absolute bottom-4 left-4 right-4">
                                                <div className="bg-white/80 backdrop-blur-sm rounded-full p-2">
                                                    <div className="flex items-center gap-2">
                                                        <span className="text-xs text-gray-600 min-w-0">
                                                            {Math.round((currentFrame / (totalFrames - 1)) * 360)}°
                                                        </span>
                                                        <div className="flex-1 bg-gray-200 rounded-full h-1">
                                                            <motion.div
                                                                className="bg-blue-500 h-1 rounded-full"
                                                                style={{ width: `${(currentFrame / (totalFrames - 1)) * 100}%` }}
                                                                transition={{ duration: 0.1 }}
                                                            />
                                                        </div>
                                                        <span className="text-xs text-gray-600">
                                                            {currentFrame + 1}/{totalFrames}
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    /* Regular Image Gallery */
                                    <div className="relative w-full h-full">
                                        <motion.img
                                            key={selectedImageIndex}
                                            src={mockRegularImages[selectedImageIndex]}
                                            alt={`Product image ${selectedImageIndex + 1}`}
                                            className="w-full h-full object-contain"
                                            initial={{ opacity: 0 }}
                                            animate={{ opacity: 1 }}
                                            transition={{ duration: 0.3 }}
                                        />

                                        {/* Navigation Arrows */}
                                        <button
                                            onClick={goToPrevious}
                                            className="absolute left-4 top-1/2 transform -translate-y-1/2 p-2 rounded-full bg-white/80 text-gray-700 hover:bg-white backdrop-blur-sm transition-colors"
                                        >
                                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                                            </svg>
                                        </button>
                                        <button
                                            onClick={goToNext}
                                            className="absolute right-4 top-1/2 transform -translate-y-1/2 p-2 rounded-full bg-white/80 text-gray-700 hover:bg-white backdrop-blur-sm transition-colors"
                                        >
                                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                                            </svg>
                                        </button>

                                        {/* Image Counter */}
                                        <div className="absolute bottom-4 right-4 bg-white/80 backdrop-blur-sm rounded-full px-3 py-1 text-sm text-gray-700">
                                            {selectedImageIndex + 1} / {mockRegularImages.length}
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Instructions */}
                            <div className="mt-8 p-4 bg-blue-50 rounded-lg">
                                <h3 className="text-lg font-semibold text-blue-900 mb-2">
                                    How to Test 360° View
                                </h3>
                                <ul className="text-blue-800 space-y-1 text-sm">
                                    <li>• Click the "360°" button to activate 360° view</li>
                                    <li>• Drag horizontally to rotate the product</li>
                                    <li>• Click play/pause to toggle auto-rotation</li>
                                    <li>• Click reset to return to start position</li>
                                    <li>• Progress bar shows rotation angle and frame</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<Product360ViewDemo />, document.getElementById('root'));
    </script>
</body>
</html>